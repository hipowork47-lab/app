import i18n from "i18next";
import { initReactI18next } from "react-i18next";

const resources = {
  es: {
    translation: {
      // General
      welcome: "Bienvenido",
      save: "Guardar",
      cancel: "Cancelar",
      delete: "Eliminar",
      edit: "Editar",
      search: "Buscar",
      confirm: "Confirmar",
      close: "Cerrar",
      actions: "Acciones",
      total: "Total",
      date: "Fecha",
      time: "Hora",
      supplier: "Proveedor",
      details: "Detalles",
      print: "Imprimir",
      syncNow: "Sincronizar",
      syncSuccess: "Sincronización completada",
      syncSuccessDesc: "Datos actualizados desde el servidor",
      syncFailed: "Error de sincronización",
      syncFailedDesc: "Verifica tu conexión e inténtalo de nuevo",

      // Invoices
      addInvoice: "Agregar factura",
      salesInvoices: "Facturas de ventas",
      purchaseInvoices: "Facturas de compra",
      previousInvoices: "Facturas anteriores",
      invoiceNumber: "Número de factura",
      quantity: "Cantidad",
      unitPrice: "Precio unitario",
      invoiceTotal: "Total de la factura",

      // Products & Categories
      products: "Productos",
      addProduct: "Agregar producto",
      productName: "Nombre del producto",
      category: "Categoría",
      categories: "Categorías",
      addCategory: "Agregar categoría",
      deleteCategory: "Eliminar categoría",
      unusedCategory: "Categoría no utilizada",
      stock: "Inventario",
      barcode: "Código de barras",
      productImage: "Imagen del producto",
      imageUrlPlaceholder: "URL de la imagen",
      productManagementTitle: "Gestión de productos",
      addNewProduct: "Agregar producto nuevo",
      editProduct: "Editar producto",
      productFormErrorTitle: "Error en los datos",
      productFormErrorDesc: "Completa los campos requeridos",
      productUpdatedTitle: "Producto actualizado",
      productUpdatedDesc: "Se actualizó {{name}} correctamente",
      productAddedTitle: "Producto agregado",
      productAddedDesc: "Se agregó {{name}} correctamente",
      productDeleteConfirm: "¿Seguro de eliminar este producto del uso?",
      productDeletedTitle: "Producto eliminado",
      productDeletedDesc: "Ya no aparecerá en nuevas facturas de compra",
      changePricePrompt: "Ingrese el nuevo precio del producto:",
      changePriceInvalid: "Precio no válido",
      changePriceToastTitle: "Actualizar precio",
      changePriceToastDesc: "Nuevo precio: {{price}}",
      selectCategoryPlaceholder: "Selecciona categoría",
      newCategory: "Nueva categoría",
      addCategoryTitleFull: "Agregar categoría nueva",
      manageCategories: "Administrar categorías",
      manageCategoriesTitle: "Administrar categorías",
      noCategories: "No hay categorías aún",
      categoryNameLabel: "Nombre de la categoría",
      categoryColorLabel: "Color",
      saveCategory: "Guardar categoría",
      categoryErrorTitle: "Error",
      categoryNameRequired: "Ingresa el nombre de la categoría",
      categoryAddedTitle: "Categoría añadida",
      categoryAddedDesc: "Se añadió \"{{name}}\" correctamente",
      categoryDeleteInUseTitle: "No se puede eliminar",
      categoryDeleteInUseDesc: "La categoría se usa en {{count}} producto(s).",
      categoryDeleteConfirm: "¿Seguro de eliminar la categoría \"{{name}}\"?",
      categoryDeletedTitle: "Categoría eliminada",
      categoryDeletedDesc: "Se eliminó \"{{name}}\" correctamente",
      noProductsAvailable: "No hay productos disponibles",

      // Reports
      reports: "Informes",
      purchaseReport: "Informe de compras",
      salesReport: "Informe de ventas",
      totalSales: "Ventas totales",
      totalPurchases: "Compras totales",
      // Reports & Stats
      reportsAndStats: "Informes e indicadores",
      reportSettings: "Configuración del reporte",
      reportType: "Tipo de reporte",
      dateFrom: "Desde fecha",
      dateTo: "Hasta fecha",
      allDates: "Todas las fechas",
      today: "Hoy",
      view: "Ver",
      reportSales: "Reporte de ventas",
      reportPurchases: "Reporte de compras",
      reportProfits: "Reporte de ganancias",
      reportTopSelling: "Productos más vendidos",
      salesReportTitle: "Reporte de ventas",
      purchasesReportTitle: "Reporte de compras",
      profitsReportTitle: "Reporte de ganancias",
      topSellingTitle: "Productos más vendidos",
      invoicesCount: "Cantidad de facturas",
      totalSalesAmount: "Total de ventas",
      totalPurchasesAmount: "Total de compras",
      netProfit: "Ganancia neta",
      soldQuantity: "Cantidad vendida",
      revenue: "Ingresos",
      exchangeRateLabel: "Tipo de cambio",
      exchangeRateEdit: "Editar tipo de cambio (actualmente: {{rate}} Bs/$)",
      exchangeRateSave: "Guardar",
      exchangeRateCancel: "Cancelar",
      exchangeRateInvalid: "Ingresa un valor válido para el tipo de cambio",
      exchangeRateUpdated: "Tipo de cambio actualizado a {{rate}} Bs/$",

      // Settings
      settings: "Configuraciones",
      currency: "Moneda",
      exchangeRate: "Tipo de cambio",
      language: "Idioma",
      changeLanguage: "Cambiar idioma",
      logout: "Cerrar sesión",

      // Login
      login: {
        title: "Iniciar sesión en el sistema",
        username: "Nombre de usuario",
        password: "Contraseña",
        button: "Iniciar sesión",
        invalidCredentials: "Nombre de usuario o contraseña incorrectos",
        adminAccount: "Cuenta del administrador",
        workerAccount: "Cuenta del empleado",
      },

      // Sales Interface
      allCategories: "Todas las categorías",
      addedTitle: "Producto añadido",
      addedDescription: "{{name}} se ha añadido al carrito",
      notFoundTitle: "No se puede",
      notFoundDesc: "No se encontró un producto con este código de barras",
      outOfStockDesc: "No queda stock disponible de este producto",
      emptyCartTitle: "Carrito vacío",
      emptyCartDesc: "Por favor, añade productos primero",
      noPaymentTitle: "Método de pago no seleccionado",
      noPaymentDesc: "Selecciona un método de pago antes de continuar",
      mainCashier: "Cajero principal",
      successTitle: "Venta completada",
      successDesc: "Venta por {{total}} {{currency}} usando {{method}}",
      barcodeScanner: "Escáner de código de barras",
      barcodePlaceholder: "Escanea o escribe el código...",
      add: "Agregar",
      availableProducts: "Productos disponibles",
      searchPlaceholder: "Buscar productos...",
      available: "Disponible",
      cart: "Carrito",
      emptyCart: "El carrito está vacío",
      paymentMethod: "Método de pago",
      cash: "Efectivo",
      card: "Tarjeta",
      transfer: "Transferencia",
      clearAll: "Borrar todo",
      checkout: "Finalizar venta",
      equivalentTo: "Equivalente a",
      exchangeRateInfo: "Tasa de cambio actual: 1$ = {{rate}} Bs",

      // Purchase Invoices
      purchaseCreateTitle: "Crear factura de compras",
      supplierPlaceholder: "Nombre del proveedor",
      selectProductLabel: "Seleccionar producto",
      selectProductPlaceholder: "Elige un producto (opcional)",
      itemNotePlaceholder: "Descripción / nota (opcional)",
      quantityPlaceholder: "Cantidad",
      unitPricePlaceholder: "Precio unitario",
      addLine: "Agregar línea",
      noItemsYet: "No hay líneas aún",
      purchaseTotal: "Total de la factura",
      bolivarTotal: "En bolívares",
      createPurchaseInvoice: "Guardar factura de compra",
      recentPurchasesTitle: "Facturas de compra anteriores",
      noPurchasesYet: "No hay facturas de compra todavía",
      purchaseInvoiceNumberLabel: "Número de factura",
      purchaseSupplierLabel: "Proveedor",
      purchaseDateLabel: "Fecha",
      purchaseRateNote: "Tipo de cambio {{rate}} Bs/$",
      errorTitle: "Error",
      errorSupplierRequired: "Ingresa el nombre del proveedor",
      errorItemsRequired: "Agrega al menos una línea antes de guardar",
      errorInvalidLine: "Ingresa cantidad y precio válidos",
      purchaseCreatedTitle: "Guardado",
      purchaseCreatedDesc: "Factura de compra creada correctamente",
    },
  },

  ar: {
    translation: {
      // عام
      welcome: "مرحباً",
      save: "حفظ",
      cancel: "إلغاء",
      delete: "حذف",
      edit: "تعديل",
      search: "بحث",
      confirm: "تأكيد",
      close: "إغلاق",
      actions: "إجراءات",
      total: "الإجمالي",
      date: "التاريخ",
      time: "الوقت",
      supplier: "المورّد",
      details: "التفاصيل",
      print: "طباعة",
      syncNow: "مزامنة الآن",
      syncSuccess: "تمت المزامنة بنجاح",
      syncSuccessDesc: "تم تحديث البيانات من الخادم",
      syncFailed: "فشلت المزامنة",
      syncFailedDesc: "تحقق من اتصالك وحاول مرة أخرى",

      // الفواتير
      addInvoice: "إضافة فاتورة",
      salesInvoices: "فواتير المبيعات",
      purchaseInvoices: "فواتير المشتريات",
      previousInvoices: "الفواتير السابقة",
      invoiceNumber: "رقم الفاتورة",
      quantity: "الكمية",
      unitPrice: "سعر الوحدة",
      invoiceTotal: "إجمالي الفاتورة",

      // المنتجات والفئات
      products: "المنتجات",
      addProduct: "إضافة منتج",
      productName: "اسم المنتج",
      category: "الفئة",
      categories: "الفئات",
      addCategory: "إضافة فئة",
      deleteCategory: "حذف الفئة",
      unusedCategory: "فئة غير مستخدمة",
      stock: "المخزون",
      barcode: "الباركود",
      productImage: "صورة المنتج",
      imageUrlPlaceholder: "رابط الصورة",
      productManagementTitle: "إدارة المنتجات",
      addNewProduct: "إضافة منتج جديد",
      editProduct: "تعديل المنتج",
      productFormErrorTitle: "خطأ في البيانات",
      productFormErrorDesc: "يرجى ملء الحقول المطلوبة",
      productUpdatedTitle: "تم تحديث المنتج",
      productUpdatedDesc: "تم تحديث {{name}} بنجاح",
      productAddedTitle: "تم إضافة المنتج",
      productAddedDesc: "تم إضافة {{name}} بنجاح",
      productDeleteConfirm: "هل أنت متأكد من حذف هذا المنتج من قائمة الاستخدام؟",
      productDeletedTitle: "تم حذف المنتج",
      productDeletedDesc: "لن يظهر في فواتير الشراء الجديدة بعد الآن",
      changePricePrompt: "أدخل السعر الجديد للمنتج:",
      changePriceInvalid: "السعر غير صحيح",
      changePriceToastTitle: "تحديث السعر",
      changePriceToastDesc: "السعر الجديد: {{price}}",
      selectCategoryPlaceholder: "اختر الفئة",
      newCategory: "فئة جديدة",
      addCategoryTitleFull: "إضافة فئة جديدة",
      manageCategories: "إدارة الفئات",
      manageCategoriesTitle: "إدارة الفئات",
      noCategories: "لا توجد فئات بعد",
      categoryNameLabel: "اسم الفئة",
      categoryColorLabel: "اللون",
      saveCategory: "حفظ الفئة",
      categoryErrorTitle: "خطأ",
      categoryNameRequired: "يرجى إدخال اسم الفئة",
      categoryAddedTitle: "تمت الإضافة",
      categoryAddedDesc: "تمت إضافة الفئة \"{{name}}\" بنجاح",
      categoryDeleteInUseTitle: "لا يمكن الحذف",
      categoryDeleteInUseDesc: "الفئة مستخدمة في {{count}} منتج.",
      categoryDeleteConfirm: "هل أنت متأكد من حذف الفئة \"{{name}}\"؟",
      categoryDeletedTitle: "تم الحذف",
      categoryDeletedDesc: "تم حذف الفئة \"{{name}}\" بنجاح.",
      noProductsAvailable: "لا توجد منتجات متاحة",

      // التقارير
      reports: "التقارير",
      purchaseReport: "تقرير المشتريات",
      salesReport: "تقرير المبيعات",
      totalSales: "إجمالي المبيعات",
      totalPurchases: "إجمالي المشتريات",
      // التقارير والإحصائيات
      reportsAndStats: "التقارير والإحصائيات",
      reportSettings: "إعدادات التقرير",
      reportType: "نوع التقرير",
      dateFrom: "من تاريخ",
      dateTo: "إلى تاريخ",
      allDates: "كل التواريخ",
      today: "اليوم",
      view: "عرض",
      reportSales: "تقرير المبيعات",
      reportPurchases: "تقرير المشتريات",
      reportProfits: "تقرير الأرباح",
      reportTopSelling: "المنتجات الأكثر مبيعاً",
      salesReportTitle: "تقرير المبيعات",
      purchasesReportTitle: "تقرير المشتريات",
      profitsReportTitle: "تقرير الأرباح",
      topSellingTitle: "المنتجات الأكثر مبيعاً",
      invoicesCount: "عدد الفواتير",
      totalSalesAmount: "إجمالي المبيعات",
      totalPurchasesAmount: "إجمالي المشتريات",
      netProfit: "صافي الربح",
      soldQuantity: "الكمية المباعة",
      revenue: "الإيرادات",
      exchangeRateLabel: "سعر الصرف",
      exchangeRateEdit: "تعديل سعر الصرف (حالياً: {{rate}} Bs/$)",
      exchangeRateSave: "حفظ",
      exchangeRateCancel: "إلغاء",
      exchangeRateInvalid: "الرجاء إدخال قيمة صحيحة لسعر الصرف",
      exchangeRateUpdated: "تم تحديث سعر الصرف إلى {{rate}} Bs/$",

      // الإعدادات
      settings: "الإعدادات",
      currency: "العملة",
      exchangeRate: "سعر الصرف",
      language: "اللغة",
      changeLanguage: "تغيير اللغة",
      logout: "تسجيل الخروج",

      // الدخول
      login: {
        title: "تسجيل الدخول إلى النظام",
        username: "اسم المستخدم",
        password: "كلمة المرور",
        button: "تسجيل الدخول",
        invalidCredentials: "اسم المستخدم أو كلمة المرور غير صحيحة",
        adminAccount: "حساب المسؤول",
        workerAccount: "حساب الموظف",
      },

      // واجهة المبيعات
      allCategories: "كل الفئات",
      addedTitle: "تمت إضافة المنتج",
      addedDescription: "{{name}} تمت إضافته إلى السلة",
      notFoundTitle: "لا يمكن",
      notFoundDesc: "لا يوجد منتج بهذا الباركود",
      outOfStockDesc: "لا يوجد مخزون متاح لهذا المنتج",
      emptyCartTitle: "السلة فارغة",
      emptyCartDesc: "الرجاء إضافة منتجات أولاً",
      noPaymentTitle: "طريقة الدفع غير محددة",
      noPaymentDesc: "حدد طريقة الدفع قبل المتابعة",
      mainCashier: "الكاشير الرئيسي",
      successTitle: "تمت عملية البيع",
      successDesc: "المجموع: {{total}} {{currency}} عبر {{method}}",
      barcodeScanner: "قارئ الباركود",
      barcodePlaceholder: "امسح أو اكتب الباركود...",
      add: "إضافة",
      availableProducts: "المنتجات المتاحة",
      searchPlaceholder: "ابحث عن المنتجات...",
      available: "متاح",
      cart: "السلة",
      emptyCart: "السلة فارغة",
      paymentMethod: "طريقة الدفع",
      cash: "نقداً",
      card: "بطاقة",
      transfer: "تحويل",
      clearAll: "تفريغ الكل",
      checkout: "إنهاء البيع",
      equivalentTo: "بما يعادل",
      exchangeRateInfo: "سعر الصرف الحالي: 1$ = {{rate}} Bs",

      // فواتير المشتريات
      purchaseCreateTitle: "إنشاء فاتورة مشتريات جديدة",
      supplierPlaceholder: "اسم المورّد",
      selectProductLabel: "اختر المنتج",
      selectProductPlaceholder: "اختر منتجاً (اختياري)",
      itemNotePlaceholder: "ملاحظة / وصف (اختياري)",
      quantityPlaceholder: "الكمية",
      unitPricePlaceholder: "السعر",
      addLine: "إضافة بند",
      noItemsYet: "لا توجد بنود حتى الآن",
      purchaseTotal: "إجمالي الفاتورة",
      bolivarTotal: "بالبوليفار",
      createPurchaseInvoice: "حفظ فاتورة المشتريات",
      recentPurchasesTitle: "فواتير المشتريات السابقة",
      noPurchasesYet: "لا توجد فواتير مشتريات بعد",
      purchaseInvoiceNumberLabel: "رقم الفاتورة",
      purchaseSupplierLabel: "المورّد",
      purchaseDateLabel: "التاريخ",
      purchaseRateNote: "سعر الصرف {{rate}} Bs/$",
      errorTitle: "خطأ",
      errorSupplierRequired: "يرجى إدخال اسم المورّد",
      errorItemsRequired: "أضف بنداً واحداً على الأقل قبل الحفظ",
      errorInvalidLine: "أدخل الكمية والسعر بشكل صحيح",
      purchaseCreatedTitle: "تم الحفظ",
      purchaseCreatedDesc: "تم إنشاء فاتورة الشراء بنجاح",
    },
  },

  en: {
    translation: {
      // General
      welcome: "Welcome",
      save: "Save",
      cancel: "Cancel",
      delete: "Delete",
      edit: "Edit",
      search: "Search",
      confirm: "Confirm",
      close: "Close",
      actions: "Actions",
      total: "Total",
      date: "Date",
      time: "Time",
      supplier: "Supplier",
      details: "Details",
      print: "Print",
      syncNow: "Sync now",
      syncSuccess: "Sync completed",
      syncSuccessDesc: "Data refreshed from the server",
      syncFailed: "Sync failed",
      syncFailedDesc: "Check your connection and try again",

      // Invoices
      addInvoice: "Add Invoice",
      salesInvoices: "Sales Invoices",
      purchaseInvoices: "Purchase Invoices",
      previousInvoices: "Previous Invoices",
      invoiceNumber: "Invoice Number",
      quantity: "Quantity",
      unitPrice: "Unit Price",
      invoiceTotal: "Invoice Total",

      // Products & Categories
      products: "Products",
      addProduct: "Add Product",
      productName: "Product Name",
      category: "Category",
      categories: "Categories",
      addCategory: "Add Category",
      deleteCategory: "Delete Category",
      unusedCategory: "Unused Category",
      stock: "Stock",
      barcode: "Barcode",
      productImage: "Product Image",
      imageUrlPlaceholder: "Image URL",
      productManagementTitle: "Product Management",
      addNewProduct: "Add New Product",
      editProduct: "Edit Product",
      productFormErrorTitle: "Data error",
      productFormErrorDesc: "Please fill required fields",
      productUpdatedTitle: "Product updated",
      productUpdatedDesc: "{{name}} updated successfully",
      productAddedTitle: "Product added",
      productAddedDesc: "{{name}} added successfully",
      productDeleteConfirm: "Are you sure you want to remove this product from use?",
      productDeletedTitle: "Product removed",
      productDeletedDesc: "It will no longer appear in new purchase invoices",
      changePricePrompt: "Enter the new price:",
      changePriceInvalid: "Invalid price",
      changePriceToastTitle: "Update price",
      changePriceToastDesc: "New price: {{price}}",
      selectCategoryPlaceholder: "Select category",
      newCategory: "New Category",
      addCategoryTitleFull: "Add new category",
      manageCategories: "Manage categories",
      manageCategoriesTitle: "Manage categories",
      noCategories: "No categories yet",
      categoryNameLabel: "Category name",
      categoryColorLabel: "Color",
      saveCategory: "Save category",
      categoryErrorTitle: "Error",
      categoryNameRequired: "Please enter category name",
      categoryAddedTitle: "Category added",
      categoryAddedDesc: "Category \"{{name}}\" added successfully",
      categoryDeleteInUseTitle: "Cannot delete",
      categoryDeleteInUseDesc: "Category used in {{count}} product(s).",
      categoryDeleteConfirm: "Delete category \"{{name}}\"?",
      categoryDeletedTitle: "Category deleted",
      categoryDeletedDesc: "\"{{name}}\" removed successfully",
      noProductsAvailable: "No products available",

      // Reports
      reports: "Reports",
      purchaseReport: "Purchase Report",
      salesReport: "Sales Report",
      totalSales: "Total Sales",
      totalPurchases: "Total Purchases",
      // Reports & Stats
      reportsAndStats: "Reports & Stats",
      reportSettings: "Report settings",
      reportType: "Report type",
      dateFrom: "From date",
      dateTo: "To date",
      allDates: "All dates",
      today: "Today",
      view: "View",
      reportSales: "Sales report",
      reportPurchases: "Purchases report",
      reportProfits: "Profit report",
      reportTopSelling: "Top selling products",
      salesReportTitle: "Sales Report",
      purchasesReportTitle: "Purchase Report",
      profitsReportTitle: "Profit Report",
      topSellingTitle: "Top Selling Products",
      invoicesCount: "Invoices count",
      totalSalesAmount: "Total sales",
      totalPurchasesAmount: "Total purchases",
      netProfit: "Net profit",
      soldQuantity: "Quantity sold",
      revenue: "Revenue",
      exchangeRateLabel: "Exchange rate",
      exchangeRateEdit: "Edit exchange rate (currently: {{rate}} Bs/$)",
      exchangeRateSave: "Save",
      exchangeRateCancel: "Cancel",
      exchangeRateInvalid: "Enter a valid exchange rate",
      exchangeRateUpdated: "Exchange rate updated to {{rate}} Bs/$",

      // Settings
      settings: "Settings",
      currency: "Currency",
      exchangeRate: "Exchange Rate",
      language: "Language",
      changeLanguage: "Change Language",
      logout: "Logout",

      // Login
      login: {
        title: "Login to the system",
        username: "Username",
        password: "Password",
        button: "Login",
        invalidCredentials: "Invalid username or password",
        adminAccount: "Admin account",
        workerAccount: "Worker account",
      },

      // Sales Interface
      allCategories: "All Categories",
      addedTitle: "Product Added",
      addedDescription: "{{name}} added to cart",
      notFoundTitle: "Cannot",
      notFoundDesc: "No product found with this barcode",
      outOfStockDesc: "No stock available for this product",
      emptyCartTitle: "Empty Cart",
      emptyCartDesc: "Please add items before checkout",
      noPaymentTitle: "Payment method not selected",
      noPaymentDesc: "Please select a payment method first",
      mainCashier: "Main Cashier",
      successTitle: "Sale Completed",
      successDesc: "Total: {{total}} {{currency}} via {{method}}",
      barcodeScanner: "Barcode Scanner",
      barcodePlaceholder: "Scan or type barcode...",
      add: "Add",
      availableProducts: "Available Products",
      searchPlaceholder: "Search for products...",
      available: "Available",
      cart: "Cart",
      emptyCart: "Cart is empty",
      paymentMethod: "Payment Method",
      cash: "Cash",
      card: "Card",
      transfer: "Transfer",
      clearAll: "Clear All",
      checkout: "Checkout",
      equivalentTo: "Equivalent to",
      exchangeRateInfo: "Current exchange rate: 1$ = {{rate}} Bs",

      // Purchase Invoices
      purchaseCreateTitle: "Create Purchase Invoice",
      supplierPlaceholder: "Supplier name",
      selectProductLabel: "Select product",
      selectProductPlaceholder: "Choose a product (optional)",
      itemNotePlaceholder: "Description / note (optional)",
      quantityPlaceholder: "Quantity",
      unitPricePlaceholder: "Unit price",
      addLine: "Add line",
      noItemsYet: "No items yet",
      purchaseTotal: "Invoice total",
      bolivarTotal: "In Bolivar",
      createPurchaseInvoice: "Save purchase invoice",
      recentPurchasesTitle: "Previous purchase invoices",
      noPurchasesYet: "No purchase invoices yet",
      purchaseInvoiceNumberLabel: "Invoice number",
      purchaseSupplierLabel: "Supplier",
      purchaseDateLabel: "Date",
      purchaseRateNote: "Exchange rate {{rate}} Bs/$",
      errorTitle: "Error",
      errorSupplierRequired: "Please enter supplier name",
      errorItemsRequired: "Add at least one line item before saving",
      errorInvalidLine: "Enter a valid quantity and price",
      purchaseCreatedTitle: "Saved",
      purchaseCreatedDesc: "Purchase invoice created successfully",
    },
  },
} as const;

const getInitialLang = () => {
  if (typeof window === "undefined") return "en";

  const userSet = localStorage.getItem("lang_user_set") === "1";
  const saved = localStorage.getItem("lang");

  // If لم يغيّر المستخدم اللغة يدوياً، نفرض EN كافتراضي حتى لو كان محفوظ سابقاً.
  if (!userSet) {
    localStorage.setItem("lang", "en");
    return "en";
  }

  if (saved) return saved;
  localStorage.setItem("lang", "en");
  return "en";
};

i18n.use(initReactI18next).init({
  resources,
  lng: getInitialLang(),
  fallbackLng: "en",
  interpolation: {
    escapeValue: false,
  },
});

if (typeof window !== "undefined") {
  i18n.on("languageChanged", (lng) => {
    try {
      localStorage.setItem("lang", lng);
      localStorage.setItem("lang_user_set", "1");
    } catch {
      // ignore write errors (e.g., private mode)
    }
  });
}

export default i18n;
